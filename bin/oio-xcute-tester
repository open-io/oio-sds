#!/usr/bin/env python

import argparse
import signal
import sys

from oio.cli import make_logger_args_parser, get_logger_from_args
from oio.xcute.tester import TesterJob


def make_arg_parser():
    log_parser = make_logger_args_parser()
    descr = """
    Xcute tester
    """
    parser = argparse.ArgumentParser(description=descr, parents=[log_parser])

    parser.add_argument('namespace', help="Namespace")

    return parser


if __name__ == '__main__':
    args = make_arg_parser().parse_args()
    logger = get_logger_from_args(args)

    conf = {'namespace': args.namespace}
    conf['redis_host'] = '127.0.0.1:6379'
    conf['job_test'] = 'job_config'

    job = TesterJob(conf, logger=logger)

    def exit_gracefully(signum, frame):
        job.exit_gracefully()

    signal.signal(signal.SIGINT, exit_gracefully)
    signal.signal(signal.SIGTERM, exit_gracefully)

    job.run()
    if not job.success:
        sys.exit(1)
